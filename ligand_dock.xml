<ROSETTASCRIPTS>
    <SCOREFXNS>
        <ScoreFunction name="ligand_soft_rep" weights="beta_nov15_soft">
            <Reweight scoretype="coordinate_constraint" weight="1.0"/>
            <Reweight scoretype="atom_pair_constraint" weight="1.0"/>
            <Reweight scoretype="angle_constraint" weight="1.0"/>
            <Reweight scoretype="dihedral_constraint" weight="1.0"/>
            <Reweight scoretype="chainbreak" weight="1.0"/>
        </ScoreFunction>
        <ScoreFunction name="hard_rep" weights="beta_nov15_cst"/>
    </SCOREFXNS>
    <LIGAND_AREAS>
        CJ: I think I might need to put in stuff for a second ligand
        <LigandArea name="docking_sidechain_b" chain="B" cutoff="6.0" add_nbr_radius="true" all_atom_mode="true"/>
        <LigandArea name="final_sidechain_b"  chain="B" cutoff="6.0" add_nbr_radius="true" all_atom_mode="true"/>
        <LigandArea name="final_backbone_b" chain="B" cutoff="7.0" add_nbr_radius="false" all_atom_mode="true" Calpha_restraints="0.3"/>
        <LigandArea name="docking_sidechain_x" chain="X" cutoff="6.0" add_nbr_radius="true" all_atom_mode="true"/>
        <LigandArea name="final_sidechain_x"  chain="X" cutoff="6.0" add_nbr_radius="true" all_atom_mode="true"/>
        <LigandArea name="final_backbone_x" chain="X" cutoff="7.0" add_nbr_radius="false" all_atom_mode="true" Calpha_restraints="0.3"/>
    </LIGAND_AREAS>
    
    <INTERFACE_BUILDERS>
        <InterfaceBuilder name="side_chain_for_docking_b" ligand_areas="docking_sidechain_b"/>
        <InterfaceBuilder name="side_chain_for_final_b" ligand_areas="final_sidechain_b"/>
        <InterfaceBuilder name="backbone_b" ligand_areas="final_backbone_b" extension_window="3"/>
        <InterfaceBuilder name="side_chain_for_docking_x" ligand_areas="docking_sidechain_x"/>
        <InterfaceBuilder name="side_chain_for_final_x" ligand_areas="final_sidechain_x"/>
        <InterfaceBuilder name="backbone_x" ligand_areas="final_backbone_x" extension_window="3"/>
    </INTERFACE_BUILDERS>
    
    <MOVEMAP_BUILDERS>
        <MoveMapBuilder name="docking_b" sc_interface="side_chain_for_docking_b" minimize_water="true"/>
        <MoveMapBuilder name="final_b" sc_interface="side_chain_for_final_b" bb_interface="backbone_b" minimize_water="true"/>
        <MoveMapBuilder name="docking_x" sc_interface="side_chain_for_docking_x" minimize_water="true"/>
        <MoveMapBuilder name="final_x" sc_interface="side_chain_for_final_x" bb_interface="backbone_x" minimize_water="true"/>

    </MOVEMAP_BUILDERS>

    <SCORINGGRIDS ligand_chain="X" width="100">
        CJ: maybe I need to determine which will be the "scored" ligand
        <ClassicGrid grid_name="classic" weight="1.0"/>
    </SCORINGGRIDS>

    <MOVERS>
	    <AddOrRemoveMatchCsts name="cstadd" cst_instruction="add_new"/>

        <HighResDocker name="high_res_docker_b" cycles="6" repack_every_Nth="3" scorefxn="ligand_soft_rep" movemap_builder="docking_b"/>
        <Transform name="transform_b" chain="B" box_size="50" move_distance="0.2" angle="20" cycles="2500" repeats="1" temperature="5"/>
        <FinalMinimizer name="final_b" scorefxn="hard_rep" movemap_builder="final_b"/>

        <HighResDocker name="high_res_docker_x" cycles="6" repack_every_Nth="3" scorefxn="ligand_soft_rep" movemap_builder="docking_x"/>
        <Transform name="transform_x" chain="X" box_size="50" move_distance="0.2" angle="20" cycles="2500" repeats="1" temperature="5"/>
        <FinalMinimizer name="final_x" scorefxn="hard_rep" movemap_builder="final_x"/>

        <InterfaceScoreCalculator name="add_scores" chains="A,B,X" scorefxn="hard_rep"/>

        <ParsedProtocol name="low_res_dock_b">
            <Add mover_name="cstadd"/>	
            <Add mover_name="transform_b"/>
        </ParsedProtocol>
        <ParsedProtocol name="low_res_dock_x">
            <Add mover_name="cstadd"/>	
            <Add mover_name="transform_x"/>
        </ParsedProtocol>

        <ParsedProtocol name="high_res_dock_b">
            <Add mover_name="high_res_docker_b"/>
            <Add mover_name="final_b"/>
        </ParsedProtocol>
        
        <ParsedProtocol name="high_res_dock_x">
            <Add mover_name="high_res_docker_x"/>
            <Add mover_name="final_x"/>
        </ParsedProtocol>

        <ParsedProtocol name="reporting">
            <Add mover_name="add_scores"/>
        </ParsedProtocol>
    </MOVERS>
    
    <PROTOCOLS>
        # 5 cycles of low res docking
        <Add mover_name="low_res_dock_x"/>
        <Add mover_name="low_res_dock_b"/>

        <Add mover_name="low_res_dock_x"/>
        <Add mover_name="low_res_dock_b"/>
        
        <Add mover_name="low_res_dock_x"/>
        <Add mover_name="low_res_dock_b"/>

        <Add mover_name="low_res_dock_x"/>
        <Add mover_name="low_res_dock_b"/>

        <Add mover_name="low_res_dock_x"/>
        <Add mover_name="low_res_dock_b"/>

        # 1 cycles of high res docking
        <Add mover_name="high_res_dock_x"/>
        <Add mover_name="high_res_dock_b"/>

        <Add mover_name="reporting"/>
    </PROTOCOLS>
</ROSETTASCRIPTS>
